<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com  -->
<!--  Last Published: Wed Mar 18 2020 20:03:10 GMT+0000 (Coordinated Universal Time)  -->
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>KEBS: SMARK Application</title>
    <th:block th:include="fragments/general-form.html :: headerfiles"/>
    <link href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" rel="stylesheet">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/accordion.css}"/>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
        }
        body {
            background-color: #f1f1f1;
        }
        #regForm {
            background-color: #ffffff;
            margin: 20px auto;
            font-family: Raleway;
            padding: 5px;
            width: 70%;
            min-width: 300px;
        }
        h1 {
            text-align: center;
        }
        input {
            padding: 10px;
            width: 100%;
            font-size: 17px;
            font-family: Raleway;
            border: 1px solid #aaaaaa;
        }
        /* Mark input boxes that gets an error on validation: */
        input.invalid {
            background-color: #ffdddd;
        }
        /* Hide all steps by default: */
        .tab {
            display: none;
        }
        button {
            background-color: #4CAF50;
            color: #ffffff;
            border: none;
            padding: 10px 20px;
            font-size: 17px;
            font-family: Raleway;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.8;
        }
        #prevBtn {
            background-color: #bbbbbb;
        }
        /* Make circles that indicate the steps of the form: */
        .step {
            height: 15px;
            width: 15px;
            margin: 0 2px;
            background-color: #bbbbbb;
            border: none;
            border-radius: 50%;
            display: inline-block;
            opacity: 0.5;
        }
        .step.active {
            opacity: 1;
        }
        /* Mark the steps that are finished and valid: */
        .step.finish {
            background-color: #4CAF50;
        }
    </style>


    <style>
        body {
            font-family: sans-serif;
        }

        a {
            color: #369;
        }

        .note {
            width: 500px;
            margin: 50px auto;
            font-size: 1.1em;
            color: #333;
            text-align: justify;
        }

        #drop-area {
            border: 2px dashed #ccc;
            border-radius: 20px;
            width: 480px;
            margin: 50px auto;
            padding: 20px;
        }

        #drop-area.highlight {
            border-color: purple;
        }

        p {
            margin-top: 0;
        }

        .my-form {
            margin-bottom: 10px;
        }

        #gallery {
            margin-top: 10px;
        }

        #gallery img {
            width: 150px;
            margin-bottom: 10px;
            margin-right: 10px;
            vertical-align: middle;
        }

        .button {
            display: inline-block;
            padding: 10px;
            background: #ccc;
            cursor: pointer;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .button:hover {
            background: #ddd;
        }

        #fileElem {
            display: none;
        }


    </style>
</head>
<body>
<div class="top-bar" th:replace="fragments/general-form.html :: top-bar"></div>
<div class="section">
    <div class="w-layout-grid main-grid">
        <div class="main-grid-side-navigation" id="w-node-d308c123a20f-c123a20d" th:replace="fragments/general-form.html :: side-navigation-bar">

        </div>
        <div id="w-node-a58aeb4cd9dd-b7f94a3d" class="main-content-div">
            <!--            <div class="content-nav" th:replace="fragments/general-form.html :: content-navigation-bar"></div>-->
            <!--            <div class="content-nav" th:fragment="content-navigation-bar">-->
            <!--                <div class="content-title">QAIMSS Platform</div>-->
            <!--                <a class="content-nav-link" th:href="@{/}"><span class="font-awesome-span">th</span>Dashboard</a><a class="content-nav-link" th:href="@{/api/v1/permit/customer}"><span class="font-awesome-span"></span>Quality Assurance</a><a class="content-nav-link" th:href="@{/api/v1/permit/apply/new/{id}(id = ${ptype?.id})}"><span class="font-awesome-span"></span><span th:text="${{ptype?.typeName}}"></span></a>-->
            <!--            </div>-->
            <div class="content-nav" th:replace="fragments/general-form.html :: content-navigation-bar"></div>
            <!--            <div class="content-wrap">-->
            <div class="content-wrap">
                <div class="content-row">
                    <div class="form-nav">
                        <a href="#" aria-current="page" class="link-block-2 w-inline-block w--current">
                            <div class="text-block-4"><span class="text-span">1</span><span th:text="${ptype?.typeName}+' '+'Application'"></span></div>
                        </a>
                        <a href="#" aria-current="page" class="link-block-2 w-inline-block w--current">
                            <div class="text-block-4"><span class="text-span">1</span>Questionnaire</div>
                        </a>
                    </div>
                    <h1 th:text="${ptype?.mark}+' '+'Application Form'"><span></span></h1>
                    <div>
                        <!--                        <h5>Kindly fill in the details below</h5>-->
                        <div class="content-row">
                            <div th:replace="fragments/general-form.html :: alerts-bar"></div>
                            <form id="regForm" name="smark-form" th:object="${myPermit}" enctype="multipart/form-data" th:action="@{/api/permit/apply/new/smark(appId=${session.appId}, pType = 2)}" method="post">

                                <!--                                DIVISION -->
                                <div>
                                    <label for="divisionId" class="field-label">Division</label>
                                    <select  id="divisionId" required="" th:field="*{productCategory}" class="select-field w-select">
                                        <option value="0">Select one...</option>
                                        <option  th:each="category : ${productCategories}" th:value="${category.id}" th:name="divisionId"  th:text="${category.standardCategory}"></option>
                                    </select>
                                    <!--                                    BROAD CATEGORIES-->
                                </div>

                                <!--                                PRODUCT CATEGORIES-->
                                <div><label for="broadCat" class="field-label">Broad Product Category</label>
                                    <select  id="broadCat" required="" th:field="*{broadProductCategory}" class="w-input">
                                        <option value="0">Select one...</option>
                                    </select>
                                </div>


                                <!--                                PRODUCT CATEGORY-->
                                <div><label for="productCategories" class="field-label">Product Category</label>
                                    <select  id="productCategories" required="" th:field="*{productCategory}" class="w-input">
                                        <option value="0">Select one...</option>
                                    </select>
                                </div>

                                <!--                                PRODUCT-->
                                <div><label for="product" class="field-label">Product</label>

                                    <select  id="product" th:field="*{product}" required="" class="w-input">
                                        <option value="0">Select one...</option>
                                    </select>
                                </div>

                                <!--                                SUB CATEGORIES-->
                                <div><label for="subc" class="field-label">Product Sub-Category</label>

                                    <select reqiured="" id="subc" th:field="*{productSubCategory}" required="" class="w-input">
                                        <option value="0">Select one...</option>
                                    </select>
                                </div>

                                <br>

                                <div>
                                    <label for="trademark" class="field-label">TradeMark/Brand Name</label>
                                    <input type="text" class="w-input" maxlength="256" name="male" data-name="Male" id="trademark" th:field="*{tradeMark}">
                                </div>

                                <br>


                                <div>
                                    <label for="noOfSitesProducingTheBrand" class="field-label">No. of sites producing the brand</label>
                                    <input type="number" required="" class="w-input" min="1" maxlength="256" name="male" data-name="Male" id="noOfSitesProducingTheBrand"  th:field="*{noOfSitesProducingTheBrand}">
                                </div>
                                <div>
                                    <label for="permitType" class="field-label"></label>
                                    <input type="hidden" class="w-input" maxlength="256" name="permitType"
                                           data-name="Male" id="permitType" required="" th:value="${ptype.id}">
                                </div>

                                <div>
                                    <label for="siteApplicable" class="field-label">Site applicable</label>
                                    <input type="text" class="w-input" maxlength="256" name="siteApplicable"
                                           data-name="Male" id="siteApplicable" th:field="*{siteApplicable}"
                                           required="">
                                    <!--                                    th:field="${siteApplicable}"-->
                                </div>
                                <h5>Upload any other relevant documents</h5>
                                <div id="drop-area">
                                    <div class="my-form">
                                        <p>
                                            Upload multiple files with the file dialog or by dragging and dropping
                                            images onto the dashed region
                                        </p>
                                        <input
                                                id="fileElem"
                                                multiple
                                                name="fileElem"
                                                onchange="handleFiles(this.files)"
                                                type="file"
                                        />
                                        <!-- accept="image/*" -->
                                        <label class="button" for="fileElem">Select some files</label>
                                    </div>
                                    <progress id="progress-bar" max="100" value="0"></progress>
                                </div>

                                <button class="w-button" data-wait="Please wait..." type="submit">Next</button>
                                <!--                                onclick="DisplayProgressMessage(this, 'Saving...');"-->
                            </form>
                            <div class="w-form-done">
                                <div>Thank you! Your submission has been received!</div>
                            </div>
                            <div class="w-form-fail">
                                <div>Oops! Something went wrong while submitting the form.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--        </div>-->
        </div>
    </div>
</div>
<script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.4.1.min.220afd743d.js" type="text/javascript"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script th:src="@{/js/webflow.js}" type="text/javascript"></script>
<!-- [if lte IE 9]>
<script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/js/mdb.min.js" type="text/javascript"></script>
<script>
    function DisplayProgressMessage(ctl, msg) {
        $(ctl).prop("disabled", true);
        $(ctl).text(msg);
        return true;
    }
</script>
<script>
    // ************************ Drag and drop ***************** //
    let dropArea = document.getElementById('drop-area');

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach((eventName) => {
        dropArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach((eventName) => {
        dropArea.addEventListener(eventName, highlight, false);
    });
    ['dragleave', 'drop'].forEach((eventName) => {
        dropArea.addEventListener(eventName, unhighlight, false);
    });

    // Handle dropped files
    dropArea.addEventListener('drop', handleDrop, false);

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function highlight(e) {
        dropArea.classList.add('highlight');
    }

    function unhighlight(e) {
        dropArea.classList.remove('active');
    }

    function handleDrop(e) {
        var dt = e.dataTransfer;
        var files = dt.files;

        handleFiles(files);
    }

    let uploadProgress = [];
    let progressBar = document.getElementById('progress-bar');

    function initializeProgress(numFiles) {
        progressBar.value = 0;
        uploadProgress = [];

        for (let i = numFiles; i > 0; i--) {
            uploadProgress.push(0);
        }
    }

    function updateProgress(fileNumber, percent) {
        uploadProgress[fileNumber] = percent;
        let total =
            uploadProgress.reduce((tot, curr) => tot + curr, 0) /
            uploadProgress.length;
        console.debug('update', fileNumber, percent, total);
        progressBar.value = total;
    }

    function handleFiles(files) {
        files = [...files];
        initializeProgress(files.length);
        files.forEach(uploadFile);
        files.forEach(previewFile);
    }

    function previewFile(file) {
        let reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onloadend = function () {
            let img = document.createElement('img');
            img.src = reader.result;
            document.getElementById('gallery').appendChild(img);
        };
    }

    function uploadFile(file, i) {
        var url = 'https://api.cloudinary.com/v1_1/joezimim007/image/upload';
        var xhr = new XMLHttpRequest();
        var formData = new FormData();
        xhr.open('POST', url, true);
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');

        // Update progress (can be used to show progress indicator)
        xhr.upload.addEventListener('progress', function (e) {
            updateProgress(i, (e.loaded * 100.0) / e.total || 100);
        });

        xhr.addEventListener('readystatechange', function (e) {
            if (xhr.readyState == 4 && xhr.status == 200) {
                updateProgress(i, 100); // <- Add this
            } else if (xhr.readyState == 4 && xhr.status != 200) {
                // Error. Inform the user
            }
        });

        formData.append('upload_preset', 'ujpu6gyk');
        formData.append('file', file);
        xhr.send(formData);
    }
</script>
<script>
    $(document).ready(function () {
            $("#divisionId").click(function () {
                let methodId = $("#divisionId").children("option:selected").val();
                // let categories = $("#sth").val()
                // console.log(categories.length)
                $.ajax({
                    method: "GET",
                    url: `/populate-broad-category/${methodId}`,
                    data: methodId,
                    success(response){
                        console.log(response);
                        let s = '';
                        for(let i = 0; i < response.length; i++) {
                            s += '<option value="' + response[i].id + '">' + response[i].category + '</option>';
                        }
                        $("#broadCat").html(s);
                    }
                })
            });

            $("#broadCat").click(function () {
                let methodId2 = $("#broadCat").children("option:selected").val();
                // let categories = $("#sth").val()
                // console.log(categories.length)
                $.ajax({
                    method: "GET",
                    url: `/populate-product-category/${methodId2}`,
                    data: methodId2,
                    success(response){
                        console.log(response);
                        var s = '';
                        for(var i = 0; i < response.length; i++) {
                            s += '<option value="' + response[i].id + '">' + response[i].name + '</option>';
                        }
                        $("#productCategories").html(s);
                    }
                })

            });

            $("#productCategories").click(function () {
                let methodId3 = $("#productCategories").children("option:selected").val();
                // let categories = $("#sth").val()
                // console.log(categories.length)
                $.ajax({
                    method: "GET",
                    url: `/populate-product-categories/${methodId3}`,
                    data: methodId3,
                    success(response){
                        console.log(response);
                        var s = '';
                        for(var i = 0; i < response.length; i++) {
                            s += '<option value="' + response[i].id + '">' + response[i].name + '</option>';
                        }
                        $("#product").html(s);
                    }
                })

            });

            $("#product").click(function () {
                let methodId4 = $("#product").children("option:selected").val();
                // let categories = $("#sth").val()
                // console.log(categories.length)
                $.ajax({
                    method: "GET",
                    url: `/populate-sub-category/${methodId4}`,
                    data: methodId4,
                    success(response){
                        console.log(response);
                        let s = '';
                        for(let i = 0; i < response.length; i++) {
                            s += '<option value="' + response[i].id + '">' + response[i].name + '</option>';
                        }
                        $("#subc").html(s);
                    }
                })

            });

            $("#subc").click(function () {
                let methodId5 = $("#subc").children("option:selected").val();
                $.ajax({
                    method: "GET",
                    url: `/populate-standards/${methodId5}`,
                    data: methodId5,
                    success(response){
                        console.log(response);
                        let s = '';
                        for (let i = 0; i < response.length; i++) {
                            s += '<option value="' + response[i].id + '">' + response[i].standardNumber + '</option>';
                        }
                        $("#ksNumber").html(s);
                    }
                })

            });
        }
    )
</script>
<script>
    $('.file-upload').file_upload();
</script>
</body>
</html>
