<!DOCTYPE html>
<div th:replace="fragments/general-form.html :: headerfiles"></div>
<body>
<div th:replace="fragments/general-form.html :: dashboard-page"></div>
<div class="dashboard-body">
    <div th:replace="fragments/general-form.html :: side-navigation-bar"></div>
    <div class="main-area">
        <div th:replace="fragments/general-form.html :: content-navigation-bar"></div>
        <section class="dashboard-content">
            <div id="w-node-27962c2db181-c676b3e3" class="main-content-div">
                <div class="content-wrap">
                    <div class="content-row">
                        <div class="row">
                            <form id="myForm" th:action="@{/api/qa/apply/new-permit(permitTypeID = ${permitType.id})}"
                                  method="post">
                                <div th:object="${permit}">
                                    <div class="form-row">
                                        <div class="col-md-12 mb-3">
                                            <p style="font-size: 20px">I/We the undersigned hereby apply for the
                                                grant/renewal of a permit/ the permit No………… to use the
                                                <span th:text="${permitType?.mark}"></span> on the commodity specified
                                                here under:</p>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="col-md-4 mb-3">
                                            <!--                                        <label for="commodityDescription" class="field-label">APPLICATION FOR  PERMIT </label>-->
                                            <img th:src="${permitType.image}" class="card-img-top"
                                                 style="width: 100px; height:100px;">
                                            <!--                                        <input type="text" class="form-control"  disabled th:value="${permitType?.mark}"  >-->
                                            <!--                                    <div class="valid-feedback">-->
                                            <!--                                        Looks good!-->
                                            <!--                                    </div>-->
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="commodityDescription" class="field-label">* COMMODITY
                                                DESCRIPTION</label>
                                            <input type="text" class="form-control" id="commodityDescription"
                                                   th:field="*{commodityDescription}" required="required">
                                            <!--                                    <div class="valid-feedback">-->
                                            <!--                                        Looks good!-->
                                            <!--                                    </div>-->
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="tradeMark" class="field-label">* TRADE MARK</label>
                                            <input type="text" class="form-control" id="tradeMark"
                                                   th:field="*{tradeMark}" required="required">
                                            <!--                                    <div class="valid-feedback">-->
                                            <!--                                        Looks good!-->
                                            <!--                                    </div>-->
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="col-md-12 mb-3">
                                            <p style="font-size: 20px">
                                                In connection with this application, I/We the undersigned hereby declare
                                                that the commodity referred to
                                                in column 2 above and the process and practice which is or will be
                                                carried out by me/us in the
                                                production of the commodity shall at all times comply with the standard
                                                specification bearing the
                                                number
                                            </p>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="col-md-4 mb-3">
                                            <label for="applicantName" class="field-label">APPLICANT NAME</label>
                                            <input id="applicantName2" name="applicantName"
                                                   th:value="${session.currentUser.firstName}+ ' ' +${session.currentUser.lastName}"
                                                   type="hidden">
                                            <input required="required" type="text" disabled class="form-control"
                                                   maxlength="256" name="applicantName" data-name="lbIdAny Aomarking"
                                                   id="applicantName"
                                                   th:value="${session.currentUser.firstName}+ ' ' +${session.currentUser.lastName}">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="sectionId" class="field-label">* Select Section</label>
                                            <select reqiured="required" id="sectionId" name="sectionId"
                                                    th:field="*{sectionId}" class="form-control">
                                                <option value="-1">Select one...</option>
                                                <option th:each="section : ${sections}" th:text="${section.section}"
                                                        th:value="${section.id}"></option>
                                                -->
                                            </select>
                                        </div>
                                        <!--                                    <div class="col-md-4 mb-3">-->
                                        <!--                                        <label for="divisionId" class="field-label" >Select Division:</label>-->
                                        <!--                                        <select id="divisionId" name="divisionId" required="required" class="form-control" th:field="*{divisionId}">-->
                                        <!--                                            <option th:value="'NULL'">Select One...</option>-->
                                        <!--                                            <option th:each="divi : ${divisions}" th:text="${divi.division}" th:value="${divi.id}"></option>-->
                                        <!--                                        </select>-->
                                        <!--                                    </div>-->
                                        <div th:if="${permitType?.localForeignStatus == 1}" class="col-md-4 mb-3">
                                            <label for="permitForeignStatus" class="field-label">*APPLICATION
                                                TYPE</label>
                                            <select class="form-control" id="permitForeignStatus"
                                                    name="permitForeignStatus"
                                                    required="required" th:field="*{permitForeignStatus}">
                                                <option th:text="'Select one.....'" th:value="-1"></option>
                                                <option th:text="'DOMESTIC'" th:value="0"></option>
                                                <option th:text="'FOREGIN'" th:value="1"></option>

                                            </select>
                                        </div>
                                        <div th:if="${permitType?.localForeignStatus == 0}" class="col-md-4 mb-3">
                                            <label for="createdOn" class="field-label">Application Date</label>
                                            <input type="text" disabled class="form-control" id="createdOn"
                                                   th:value="${applicationDate}" required="required">
                                        </div>

                                    </div>

                                    <div>
                                        <div class="form-group">
                                            <!--                                            <div class="col-md-4 mb-3">-->
                                            <!--                                                <button class="btn btn-primary" id="check" type="button">Validate form-->
                                            <!--                                                </button>-->
                                            <!--                                            </div>-->
                                            <div class="col-md-4 mb-3">
                                                <button class="btn btn-primary" id="mySubmit" type="submit">
                                                    Submit form
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>


</div>
<div th:replace="fragments/general-form.html :: scripts"></div>
<script>
    document.onreadystatechange = function(){
        showSpinnerOnLoad(document)
    }

    function loadSpinner(){
        showSpinner(document)
    }
</script>
<script>
    $(document).ready(function () {

        $("#mySubmit").click(function () {
            let allAreFilled = true;
            document.getElementById("myForm").querySelectorAll("[required]").forEach(function (i) {
                if (!allAreFilled) return;
                let inputID = `#${i.id}`
                if (!i.value) {
                    $(inputID).addClass('error');
                    allAreFilled = false;
                }
                if (i.value) {
                    $(inputID).removeClass('error');
                }
                if (i.type === "radio") {
                    let radioValueCheck = false;
                    document.getElementById("myForm").querySelectorAll(`[name=${i.name}]`).forEach(function (r) {
                        if (r.checked) radioValueCheck = true;
                    })
                    allAreFilled = radioValueCheck;
                }

            })

            if ($('#sectionId').val() == -1) {
                $('#sectionId').addClass('error');
                allAreFilled = false;
                return false;
            } else {
                $('#sectionId').removeClass('error');
                return true;
            }

            if ($('#permitForeignStatus').val() == -1) {
                $('#permitForeignStatus').addClass('error');
                allAreFilled = false;
                return false;
            } else {
                $('#permitForeignStatus').removeClass('error');
                return true;
            }

            if (!allAreFilled) {
                // alert('Fill all the fields');
            } else {
                return true;
            }
        });

        $("#nonComplianceStatus_yes").click(function(){
            'use strict';
            window.addEventListener('load', function() {
// Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
// Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        });

    });
</script>
<script>

</script>
<script>
    $(document).ready(function(){
        $("#nonComplianceStatus_no").click(function(){
            if($(this).is(':checked')){
                $("#nonCompliance_rm").css("display","block")
            }else{
                $("#nonCompliance_rm").css("display","none")
            }
        });
        $("#nonComplianceStatus_yes").click(function(){
            if($(this).is(':checked')){
                $("#nonCompliance_rm").css("display","none")
            }
        });

    });

    var check = function() {
        var  kraPin = document.getElementById('kraPin').value
        if (kraPin.length < 20 && kraPin.length >13 ){
            document.getElementById('kraPin').style.borderColor = "green";
            document.getElementById("submitDetails"). = false;
            // document.getElementById('message').style.color = 'green';
            // document.getElementById('message').innerHTML = 'matching';
        } else {
            document.getElementById('kraPin').style.borderColor = "red";
            document.getElementById("submitDetails"). = true;
            alert("KRA PIN IS LESS THAN 13 OR MORE THAN 20 !");
            // document.getElementById('message').style.color = 'red';
            // document.getElementById('message').innerHTML = 'not matching';
        }
    }

    var checkBRS = function() {
        var  brs = document.getElementById('registrationNumber').value
        if (brs.length < 20 && brs.length >13 ) {
            document.getElementById('registrationNumber').style.borderColor = "green";
            document.getElementById("submitDetails"). = false;
            // document.getElementById('message').style.color = 'green';
            // document.getElementById('message').innerHTML = 'matching';
        } else {
            document.getElementById('registrationNumber').style.borderColor = "red";
            document.getElementById("submitDetails"). = true;
            alert("BRS PIN IS LESS THAN 13 OR MORE THAN 20 !");
            // document.getElementById('message').style.color = 'red';
            // document.getElementById('message').innerHTML = 'not matching';
        }
    }
</script>
<script>
    $(document).ready(function() {
            $("#standardCategory").click(function () {
                let methodId = $("#standardCategory").val()
                // let categories = $("#sth").val()
                // console.log(categories.length)
                $.ajax({
                    method: "GET",
                    url: `/api/auth/populate-broad-category/${methodId}`,
                    data: methodId,
                    success(response) {
                        console.log(response)
                        let s = '';
                        s += ' <option value="0">Select One...</option>';
                        for (let i = 0; i < response.length; i++) {
                            // response.push('Select one')
                            s += '<option value="' + response[i].id + '">' + response[i].category + '</option>';
                        }
                        $("#broadCat").html(s);
                    }
                })
            });

            $("#broadCat").click(function () {
                let methodId2 = $("#broadCat").val()
                // let categories = $("#sth").val()
                // console.log(categories.length)
                $.ajax({
                    method: "GET",
                    url: `/api/auth/populate-product-category/${methodId2}`,
                    data: methodId2,
                    success(response) {
                        console.log(response)
                        var s = '';
                        s += ' <option value="0">Select One...</option>';
                        for (var i = 0; i < response.length; i++) {
                            // response.push('Select one')
                            s += '<option value="' + response[i].id + '">' + response[i].name + '</option>';
                        }
                        $("#productCategories").html(s);
                    }
                })

            });

            $("#productCategories").click(function () {
                let methodId3 = $("#productCategories").val()
                // let categories = $("#sth").val()
                // console.log(categories.length)
                $.ajax({
                    method: "GET",
                    url: `/api/auth/populate-product-categories/${methodId3}`,
                    data: methodId3,
                    success(response) {
                        console.log(response)
                        var s = '';
                        s += ' <option value="0">Select One...</option>';
                        for (var i = 0; i < response.length; i++) {
                            // response.push('Select one')
                            s += '<option value="' + response[i].id + '">' + response[i].name + '</option>';
                        }
                        $("#product").html(s);
                    }
                })

            });

            $("#product").click(function () {
                let methodId4 = $("#product").val()
                // let categories = $("#sth").val()
                // console.log(categories.length)
                $.ajax({
                    method: "GET",
                    url: `/api/auth/populate-sub-category/${methodId4}`,
                    data: methodId4,
                    success(response) {
                        console.log(response)
                        let s = '';
                        s += ' <option value="0">Select One...</option>';
                        for (let i = 0; i < response.length; i++) {
                            // response.push('Select one')
                            s += '<option value="' + response[i].id + '">' + response[i].name + '</option>';
                        }
                        $("#productsubcat").html(s);
                    }
                })

            });

            $("#divisionId").click(function () {
                let divisionId = $("#divisionId").val()
                // console.log(categories.length)
                if (divisionId !== 0) {
                    $.ajax({
                        method: "GET",
                        url: `/api/auth/section-list/${divisionId}`,
                        success(response) {
                            console.log(response)
                            var s = '';
                            s += ' <option value="0">Select One...</option>';
                            for (var i = 0; i < response.length; i++) {
                                // response.push('Select one')
                                s += '<option value="' + response[i].id + '">' + response[i].section + '</option>';
                            }
                            $("#sectionId").html(s);
                        }
                    })
                }

            });

            // $("#productsubcat").click(function () {
            //     let methodId5 = $("#productsubcat").val()
            //     // let categories = $("#sth").val()
            //     // console.log(categories.length)
            //     $.ajax({
            //         method: "GET",
            //         url: `/api/auth/populate-standards/${methodId5}`,
            //         data: methodId5,
            //         success(response){
            //             console.log(response)
            //             let s = '';
            //             s +=  ' <option value="0">Select One...</option>';
            //             for(let i = 0; i < response.length; i++) {
            //                 // response.push('Select one')
            //                 s += '<option value="' + response[i].id + '">' + response[i].name + '</option>';
            //             }
            //             $("#productStandard").html(s);
            //         }
            //     })
            //
            // });

        }
    )
</script>
</body>

