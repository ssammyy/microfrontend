<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test">
    <process id="msFuelMonitoringProcess" name="MS Fuel Monitoring Process" isExecutable="true">
        <startEvent id="startevent1" name="Start"></startEvent>
        <userTask id="msFmHodAssignOfficer" name="HOD Assign Officer">
            <extensionElements>
                <activiti:taskListener event="assignment" expression="${bpmnNotifications.sendEmail(task)}"></activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow1" sourceRef="startevent1" targetRef="msFmHodAssignOfficer"></sequenceFlow>
        <userTask id="msFmFIllSampleCollectionForm" name="Fill Sample Collection Form">
            <extensionElements>
                <activiti:taskListener event="assignment" expression="${bpmnNotifications.sendEmail(task)}"></activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow2" sourceRef="msFmHodAssignOfficer" targetRef="msFmFIllSampleCollectionForm"></sequenceFlow>
        <userTask id="msFmGenSSFAndLabSubmit" name="Gen SSF and Lab Submit">
            <extensionElements>
                <activiti:taskListener event="assignment" expression="${bpmnNotifications.sendEmail(task)}"></activiti:taskListener>
            </extensionElements>
        </userTask>
        <serviceTask id="msFmGenerateBSNumber" name="Generate BS Number" activiti:expression="${bpmnCommonFunctions.generateBSNumber()}"></serviceTask>
        <userTask id="msFmLabProcessSamples" name="Lab Process Samples">
            <extensionElements>
                <activiti:taskListener event="assignment" expression="${bpmnNotifications.sendEmail(task)}"></activiti:taskListener>
            </extensionElements>
        </userTask>
        <userTask id="msFmLabReportCompliant" name="Check If Lab Report Compliant">
            <extensionElements>
                <activiti:taskListener event="assignment" expression="${bpmnNotifications.sendEmail(task)}"></activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow6" sourceRef="msFmLabProcessSamples" targetRef="msFmLabReportCompliant"></sequenceFlow>
        <exclusiveGateway id="exclusivegateway1" name="Exclusive Gateway"></exclusiveGateway>
        <sequenceFlow id="flow7" sourceRef="msFmLabReportCompliant" targetRef="exclusivegateway1"></sequenceFlow>
        <userTask id="msFmSendProformaInvoice" name="Send Proforma Invoice">
            <extensionElements>
                <activiti:taskListener event="assignment" expression="${bpmnNotifications.sendEmail(task)}"></activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow8" sourceRef="exclusivegateway1" targetRef="msFmSendProformaInvoice">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${labReportCompliant==0}]]></conditionExpression>
        </sequenceFlow>
        <userTask id="msFmPayment" name="Make Payment">
            <extensionElements>
                <activiti:taskListener event="assignment" expression="${bpmnNotifications.sendEmail(task)}"></activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow9" sourceRef="msFmSendProformaInvoice" targetRef="msFmPayment"></sequenceFlow>
        <userTask id="msFmRemediate" name="Remediate">
            <extensionElements>
                <activiti:taskListener event="assignment" expression="${bpmnNotifications.sendEmail(task)}"></activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow10" sourceRef="msFmPayment" targetRef="msFmRemediate"></sequenceFlow>
        <sequenceFlow id="flow11" sourceRef="msFmRemediate" targetRef="parallelgateway1"></sequenceFlow>
        <parallelGateway id="parallelgateway1" name="Exclusive Gateway"></parallelGateway>
        <sequenceFlow id="flow12" sourceRef="parallelgateway1" targetRef="msFmCustomerRemediationEmail"></sequenceFlow>
        <serviceTask id="msFmCustomerRemediationEmail" name="Send Customer Remediation Email" activiti:expression="${bpmnNotifications.sendEmailServiceTask(customerEmail,131)}"></serviceTask>
        <endEvent id="endevent1" name="End">
            <extensionElements>
                <activiti:executionListener event="end" expression="${marketSurveillanceBpmn.endMsFuelMonitoringProcess(objectId)}"></activiti:executionListener>
            </extensionElements>
        </endEvent>
        <sequenceFlow id="flow13" sourceRef="msFmCustomerRemediationEmail" targetRef="endevent1"></sequenceFlow>
        <serviceTask id="msFmEpraRemediationEmail" name="Send EPRA Remediation Email" activiti:expression="${bpmnNotifications.sendEmailServiceTask(epraEmail,132)}"></serviceTask>
        <sequenceFlow id="flow14" sourceRef="parallelgateway1" targetRef="msFmEpraRemediationEmail"></sequenceFlow>
        <endEvent id="endevent2" name="End"></endEvent>
        <sequenceFlow id="flow15" sourceRef="msFmEpraRemediationEmail" targetRef="endevent2"></sequenceFlow>
        <userTask id="msFmUpdateBSNumberAndSubmit" name="Update BS Number and Submit">
            <extensionElements>
                <activiti:taskListener event="assignment" expression="${bpmnNotifications.sendEmail(task)}"></activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow16" sourceRef="msFmGenerateBSNumber" targetRef="msFmUpdateBSNumberAndSubmit"></sequenceFlow>
        <sequenceFlow id="flow17" sourceRef="msFmFIllSampleCollectionForm" targetRef="msFmGenSSFAndLabSubmit"></sequenceFlow>
        <sequenceFlow id="flow18" sourceRef="msFmGenSSFAndLabSubmit" targetRef="msFmGenerateBSNumber"></sequenceFlow>
        <sequenceFlow id="flow19" sourceRef="msFmUpdateBSNumberAndSubmit" targetRef="msFmLabProcessSamples"></sequenceFlow>
        <sequenceFlow id="flow20" sourceRef="exclusivegateway1" targetRef="msFmRemediate">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${labReportCompliant==1}]]></conditionExpression>
        </sequenceFlow>
    </process>
    <bpmndi:BPMNDiagram id="BPMNDiagram_msFuelMonitoringProcess">
        <bpmndi:BPMNPlane bpmnElement="msFuelMonitoringProcess" id="BPMNPlane_msFuelMonitoringProcess">
            <bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1">
                <omgdc:Bounds height="35.0" width="35.0" x="70.0" y="70.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmHodAssignOfficer" id="BPMNShape_msFmHodAssignOfficer">
                <omgdc:Bounds height="71.0" width="121.0" x="190.0" y="50.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmFIllSampleCollectionForm" id="BPMNShape_msFmFIllSampleCollectionForm">
                <omgdc:Bounds height="70.0" width="111.0" x="410.0" y="51.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmGenSSFAndLabSubmit" id="BPMNShape_msFmGenSSFAndLabSubmit">
                <omgdc:Bounds height="73.0" width="121.0" x="610.0" y="49.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmGenerateBSNumber" id="BPMNShape_msFmGenerateBSNumber">
                <omgdc:Bounds height="63.0" width="121.0" x="810.0" y="54.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmLabProcessSamples" id="BPMNShape_msFmLabProcessSamples">
                <omgdc:Bounds height="68.0" width="131.0" x="1202.0" y="52.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmLabReportCompliant" id="BPMNShape_msFmLabReportCompliant">
                <omgdc:Bounds height="63.0" width="125.0" x="1205.0" y="190.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="exclusivegateway1" id="BPMNShape_exclusivegateway1">
                <omgdc:Bounds height="40.0" width="40.0" x="830.0" y="201.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmSendProformaInvoice" id="BPMNShape_msFmSendProformaInvoice">
                <omgdc:Bounds height="59.0" width="121.0" x="610.0" y="192.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmPayment" id="BPMNShape_msFmPayment">
                <omgdc:Bounds height="55.0" width="105.0" x="440.0" y="194.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmRemediate" id="BPMNShape_msFmRemediate">
                <omgdc:Bounds height="55.0" width="105.0" x="798.0" y="340.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="parallelgateway1" id="BPMNShape_parallelgateway1">
                <omgdc:Bounds height="40.0" width="40.0" x="948.0" y="348.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmCustomerRemediationEmail" id="BPMNShape_msFmCustomerRemediationEmail">
                <omgdc:Bounds height="70.0" width="118.0" x="1030.0" y="333.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
                <omgdc:Bounds height="35.0" width="35.0" x="1250.0" y="351.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmEpraRemediationEmail" id="BPMNShape_msFmEpraRemediationEmail">
                <omgdc:Bounds height="71.0" width="115.0" x="911.0" y="460.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="endevent2" id="BPMNShape_endevent2">
                <omgdc:Bounds height="35.0" width="35.0" x="1094.0" y="478.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="msFmUpdateBSNumberAndSubmit" id="BPMNShape_msFmUpdateBSNumberAndSubmit">
                <omgdc:Bounds height="75.0" width="121.0" x="1008.0" y="48.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
                <omgdi:waypoint x="105.0" y="87.0"></omgdi:waypoint>
                <omgdi:waypoint x="190.0" y="85.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
                <omgdi:waypoint x="311.0" y="85.0"></omgdi:waypoint>
                <omgdi:waypoint x="410.0" y="86.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow6" id="BPMNEdge_flow6">
                <omgdi:waypoint x="1267.0" y="120.0"></omgdi:waypoint>
                <omgdi:waypoint x="1267.0" y="190.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow7" id="BPMNEdge_flow7">
                <omgdi:waypoint x="1205.0" y="221.0"></omgdi:waypoint>
                <omgdi:waypoint x="870.0" y="221.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow8" id="BPMNEdge_flow8">
                <omgdi:waypoint x="830.0" y="221.0"></omgdi:waypoint>
                <omgdi:waypoint x="731.0" y="221.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow9" id="BPMNEdge_flow9">
                <omgdi:waypoint x="610.0" y="221.0"></omgdi:waypoint>
                <omgdi:waypoint x="545.0" y="221.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow10" id="BPMNEdge_flow10">
                <omgdi:waypoint x="492.0" y="249.0"></omgdi:waypoint>
                <omgdi:waypoint x="492.0" y="367.0"></omgdi:waypoint>
                <omgdi:waypoint x="798.0" y="367.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow11" id="BPMNEdge_flow11">
                <omgdi:waypoint x="903.0" y="367.0"></omgdi:waypoint>
                <omgdi:waypoint x="948.0" y="368.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow12" id="BPMNEdge_flow12">
                <omgdi:waypoint x="988.0" y="368.0"></omgdi:waypoint>
                <omgdi:waypoint x="1030.0" y="368.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow13" id="BPMNEdge_flow13">
                <omgdi:waypoint x="1148.0" y="368.0"></omgdi:waypoint>
                <omgdi:waypoint x="1250.0" y="368.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow14" id="BPMNEdge_flow14">
                <omgdi:waypoint x="968.0" y="388.0"></omgdi:waypoint>
                <omgdi:waypoint x="968.0" y="460.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow15" id="BPMNEdge_flow15">
                <omgdi:waypoint x="1026.0" y="495.0"></omgdi:waypoint>
                <omgdi:waypoint x="1094.0" y="495.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow16" id="BPMNEdge_flow16">
                <omgdi:waypoint x="931.0" y="85.0"></omgdi:waypoint>
                <omgdi:waypoint x="1008.0" y="85.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow17" id="BPMNEdge_flow17">
                <omgdi:waypoint x="521.0" y="86.0"></omgdi:waypoint>
                <omgdi:waypoint x="610.0" y="85.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow18" id="BPMNEdge_flow18">
                <omgdi:waypoint x="731.0" y="85.0"></omgdi:waypoint>
                <omgdi:waypoint x="810.0" y="85.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow19" id="BPMNEdge_flow19">
                <omgdi:waypoint x="1129.0" y="85.0"></omgdi:waypoint>
                <omgdi:waypoint x="1202.0" y="86.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow20" id="BPMNEdge_flow20">
                <omgdi:waypoint x="850.0" y="241.0"></omgdi:waypoint>
                <omgdi:waypoint x="850.0" y="340.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
        </bpmndi:BPMNPlane>
    </bpmndi:BPMNDiagram>
</definitions>