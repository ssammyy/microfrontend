<div class="main-content">
    <div class="loading-spinner ">
        <ngx-spinner
                bdColor="rgba(51,51,51,0.8)"
                color="#fff"
                size="medium"
                type="ball-scale-multiple">
            <p style="font-size: 20px; color: white">Loading Data Please Wait...</p>
        </ngx-spinner>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-primary card-header-icon">
                        <div class="card-icon">
                            <i class="material-icons">assignment</i>
                        </div>
                        <h4 class="card-title">Organizations: All My Organizations</h4>
                    </div>
                    <div class="card-body">
                        <div class="toolbar">
                            <!--        Here you can write extra buttons/actions for the toolbar              -->
                        </div>
                        <div class="material-datatables">
                            <div class="table-responsive">
                                <table id="datatables"
                                       class="table table-striped table-no-bordered table-hover"
                                >
                                    <thead>
                                    <tr>
                                        <th>No.</th>
                                        <th>Company Name</th>
<!--                                        <th class="knw">Firm Type</th>-->
                                        <th>Status</th>
                                        <th class="disabled-sorting text-right">Actions</th>
                                    </tr>
                                    </thead>
                                    <tfoot>
                                    <tr>
                                        <th>No.</th>
                                        <th>Company Name</th>
<!--                                        <th class="knw">Firm Type</th>-->
                                        <th>Active</th>
                                        <th class="disabled-sorting text-right">Actions</th>
                                    </tr>
                                    </tfoot>
                                    <tbody>
                                    <tr *ngFor="let row of companies$ | async">
                                        <td>{{row.id}}</td>
                                        <td>{{row.name}}</td>
<!--                                        <td>{{row.firmType}}</td>-->
                                        <td >
                                            <div *ngIf="row.status==1">
                                                <span class="badge badge-info" style="width: 94px;">Active</span>
                                            </div>
                                            <div *ngIf="row.status==2">
                                                <span class="badge badge-default" style="width: 94px;">Suspended</span>
                                            </div>
                                            <div *ngIf="row.status==0">
                                                <span class="badge badge-info" style="width: 94px;">Closed</span>
                                            </div>
                                            <div *ngIf="row.status==4">
                                                <span class="badge badge-warning" style="width: 94px;">In-Active</span>
                                            </div>
                                        </td>
                                        <td class="text-right">
                                            <a (click)="viewRecord(row)" data-target="#companyDetailsModal"
                                               data-toggle="modal"
                                               class="btn btn-link btn-info"
                                            ><i class="material-icons">remove_red_eye</i>View Details</a>
                                            <a (click)="updateTurnoverRecord(row)"
                                               class="btn btn-link btn-info"><i
                                                    class="material-icons">remove_red_eye</i>Update Firm Type</a>
                                            <br>
                                            <a (click)="editRecord(row)"
                                               class="btn btn-link btn-info"><i
                                                    class="material-icons">remove_red_eye</i> Edit Details</a>
                                            <br>
                                            <a (click)="onClickPlantDetails(row)"
                                               class="btn btn-link btn-warning"><i
                                                    class="material-icons">dvr</i> View Branches</a>

                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- end content-->
                </div>
                <!--  end card  -->
            </div>
            <!-- end col-md-12 -->
        </div>
        <!-- end row -->
    </div>

    <!-- Company Details Modal -->
    <div aria-hidden="true" aria-labelledby="companyDetailsLabel" class="modal fade" id="companyDetailsModal" role="dialog"
         tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">{{currDivLabel}}</h4>
                    <button aria-hidden="true" class="close" data-dismiss="modal" mat-button type="button">
                        <i class="material-icons">clear</i>
                    </button>
                </div>
                <div class="modal-body">
                    <form [formGroup]="companyDetailsForm">
                        <div class="form-group bmd-form-group is-filled">
                            <h5 class="mb-3" style="color: #0066B1">General Company Information</h5>
                            <div class="row">

                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Company Registration Number</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.registrationNumber.invalid && formCompanyDetailsForm.registrationNumber.errors"
                                               class="form-control two-column-input"
                                               formControlName="registrationNumber"
                                               name="registrationNumber" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.registrationNumber.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.registrationNumber.errors.required">
                                                Company Registration Number is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Director's Id Number</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.directorIdNumber.invalid && formCompanyDetailsForm.directorIdNumber.errors"
                                               class="form-control two-column-input"
                                               formControlName="directorIdNumber"
                                               name="directorIdNumber" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.directorIdNumber.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.directorIdNumber.errors.required">
                                                Director's Id Number is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Company Name</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.name.invalid && formCompanyDetailsForm.name.errors"
                                               class="form-control two-column-input"
                                               formControlName="name"
                                               name="name" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.name.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.name.errors.required">
                                                Company Name is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label><b>KRA Pin</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.kraPin.invalid && formCompanyDetailsForm.kraPin.errors"
                                               class="form-control two-column-input"
                                               formControlName="kraPin"
                                               name="kraPin" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.kraPin.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.kraPin.errors.required">KRA Pin is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Firm Type</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.firmType.invalid && formCompanyDetailsForm.firmType.errors"
                                               class="form-control two-column-input"
                                               formControlName="firmType"
                                               name="firmType" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.firmType.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.firmType.errors.required">Firm Type is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Yearly Turnover KSH</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.yearlyTurnover.invalid && formCompanyDetailsForm.yearlyTurnover.errors"
                                               class="form-control two-column-input"
                                               formControlName="yearlyTurnover"
                                               name="yearlyTurnover" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.yearlyTurnover.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.yearlyTurnover.errors.required">Yearly Turnover is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group"  *ngIf="businessLines$ | async as apps">
                                        <label><b>Line Of Business</b></label>
                                        <select (change)="updateSelectedBusinessLine()"
                                                [class.is-invalid]="formCompanyDetailsForm.businessLines.invalid && formCompanyDetailsForm.businessLines.errors"
                                                aria-describedby="inputGroup-sizing-lg" aria-label="Small"
                                                class="form-control" formControlName="businessLines" name="businessLines" required>
                                            <option [value]="" selected>Please select</option>
                                            <option *ngFor="let app of apps| filterPipe: {status: true}" [ngValue]="app.id"
                                            >{{app.name}}</option>
                                        </select>
                                        <div *ngIf="submitted && formCompanyDetailsForm.businessLines.errors" class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.businessLines.errors.required">Line Of Business is required</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group"  *ngIf="businessNatures$ | async as apps">
                                        <label><b> Nature of Business</b></label>
                                        <select (change)="updateSelectedBusinessNatures()"
                                                [class.is-invalid]="formCompanyDetailsForm.businessNatures.invalid && formCompanyDetailsForm.businessNatures.errors"
                                                aria-describedby="inputGroup-sizing-lg" aria-label="Small"
                                                class="form-control" formControlName="businessNatures" name="businessNatures" required>
                                            <option [value]="" selected>Please select</option>
                                            <option *ngFor="let app of apps| filterPipe:{status: true, businessLinesId:selectedBusinessLine }" [ngValue]="app.id"
                                            >{{app.name}}</option>
                                        </select>
                                        <div *ngIf="submitted && formCompanyDetailsForm.businessNatures.errors" class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.businessNatures.errors.required"> Nature of Business is required</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Plot Number</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.otherBusinessNatureType.invalid && formCompanyDetailsForm.otherBusinessNatureType.errors"
                                               class="form-control two-column-input"
                                               formControlName="otherBusinessNatureType"
                                               name="otherBusinessNatureType" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.otherBusinessNatureType.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.otherBusinessNatureType.errors.required">Plot Number is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <h5 class="mb-3" style="color: #0066B1">Address & Contact Information</h5>
                            <br>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Postal Address</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.postalAddress.invalid && formCompanyDetailsForm.postalAddress.errors"
                                               class="form-control two-column-input"
                                               formControlName="postalAddress"
                                               name="postalAddress" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.postalAddress.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.postalAddress.errors.required">Postal Address is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Physical Address</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.physicalAddress.invalid && formCompanyDetailsForm.physicalAddress.errors"
                                               class="form-control two-column-input"
                                               formControlName="physicalAddress"
                                               name="physicalAddress" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.physicalAddress.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.physicalAddress.errors.required">Physical Address is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Plot Number</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.plotNumber.invalid && formCompanyDetailsForm.plotNumber.errors"
                                               class="form-control two-column-input"
                                               formControlName="plotNumber"
                                               name="plotNumber" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.plotNumber.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.plotNumber.errors.required">Plot Number is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Company Email</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.companyEmail.invalid && formCompanyDetailsForm.companyEmail.errors"
                                               class="form-control two-column-input"
                                               formControlName="companyEmail"
                                               name="companyEmail" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.companyEmail.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.companyEmail.errors.required">Company Email is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <br>
                            <h5 class="mb-3" style="color: #0066B1">Physical Location Information Details</h5>
                            <br>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Building Name</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.buildingName.invalid && formCompanyDetailsForm.buildingName.errors"
                                               class="form-control two-column-input"
                                               formControlName="buildingName"
                                               name="buildingName" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.buildingName.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.buildingName.errors.required">Building Name is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col">
                                    <div class="form-group">
                                        <label><b>Street Name</b> </label>
                                        <input [class.is-invalid]="formCompanyDetailsForm.streetName.invalid && formCompanyDetailsForm.streetName.errors"
                                               class="form-control two-column-input"
                                               formControlName="streetName"
                                               name="streetName" required type="text">
                                        <div *ngIf="submitted && formCompanyDetailsForm.streetName.errors"
                                             class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.streetName.errors.required">Street Name is
                                                required
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group" >
                                        <label><b>Region</b></label>
                                        <select (change)="updateSelectedRegion()"
                                                [class.is-invalid]="formCompanyDetailsForm.region.invalid && formCompanyDetailsForm.region.errors"
                                                aria-describedby="inputGroup-sizing-lg" aria-label="Small"
                                                class="form-control" formControlName="region" name="region" required>
                                            <option [value]="" selected>Please select</option>
                                            <option *ngFor="let app of msRegions| filterPipe: {status: true}" [ngValue]="app.id"
                                            >{{app.region}}</option>
                                        </select>
                                        <div *ngIf="submitted && formCompanyDetailsForm.region.errors" class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.region.errors.required">Region is required</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group" >
                                        <label><b>County</b></label>
                                        <select (change)="updateSelectedCounty()"
                                                [class.is-invalid]="formCompanyDetailsForm.county.invalid && formCompanyDetailsForm.county.errors"
                                                aria-describedby="inputGroup-sizing-lg" aria-label="Small" disabled
                                                class="form-control" formControlName="county" name="county" required>
                                            <option [value]="" selected>Please select</option>
                                            <option *ngFor="let app of msCountiesList| filterPipe: {status: true, region: selectedRegion}" [ngValue]="app.id"
                                            >{{app.county}}</option>
                                        </select>
                                        <div *ngIf="submitted && formCompanyDetailsForm.county.errors" class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.county.errors.required">County is required</div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="form-group" >
                                        <label><b>Town/Market center</b></label>
                                        <select (change)="updateSelectedTown()"
                                                [class.is-invalid]="formCompanyDetailsForm.town.invalid && formCompanyDetailsForm.town.errors"
                                                aria-describedby="inputGroup-sizing-lg" aria-label="Small" disabled
                                                class="form-control" formControlName="town" name="town" required>
                                            <option [value]="" selected>Please select</option>
                                            <option *ngFor="let app of msTowns"
                                                    [ngValue]="app?.id">{{app?.town}}</option>
                                        </select>
                                        <div *ngIf="submitted && formCompanyDetailsForm.town.errors" class="invalid-feedback">
                                            <div *ngIf="formCompanyDetailsForm.town.errors.required">Town/Market center is required</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="form-group" >
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>

                    <div class="modal-footer">
                        <button class="btn btn-danger" data-dismiss="modal" mat-raised-button
                                type="button">
                            Close
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- End Company Details Modal -->

    <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">{{currDivLabel}}</h4>
                    <button mat-button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        <i class="material-icons">clear</i>
                    </button>
                </div>
                <div class="modal-body">
                    <div *ngIf="(currDiv == 'updateTurnOver')">
                        <form [formGroup]="updateTurnOverDetailsForm" class="form">
                            <div class="form-body">
                                <div class="form-group">
                                    <div>
                                        <label for="selectedFirmTypeID"><b>Select firm type Status</b></label>
                                        <mat-form-field id="selectedFirmTypeID">
                                            <mat-select placeholder="Please Select an option"
                                                        formControlName="selectedFirmTypeID"
                                                        [class.is-invalid]="formUpdateTurnOverDetailsForm.selectedFirmTypeID.invalid && formUpdateTurnOverDetailsForm.selectedFirmTypeID.touched"
                                                        name="selectedFirmTypeID">
                                                <mat-option [value]="" selected>Please select</mat-option>
                                                <mat-option  *ngFor="let app of loadedFirmType" [value]="app.id">{{app.firmType}}</mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button mat-raised-button type="button"
                            class="btn btn-danger" data-dismiss="modal" >Close
                    </button>
                    <button *ngIf="(currDiv == 'updateTurnOver')" mat-raised-button type="button" class="btn btn-success" data-dismiss="modal"
                            (click)="onClickSaveFirmType(updateTurnOverDetailsForm.valid);"
                            [disabled]="!updateTurnOverDetailsForm.valid"
                    >SUBMIT
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End Sample Submit Lab Results Modal -->
</div>
